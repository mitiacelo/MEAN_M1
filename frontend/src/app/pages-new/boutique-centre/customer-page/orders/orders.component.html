<div class="orders-container">
    <h1>Mes Commandes</h1>
  
    @if (loading) {
      <p>Chargement des commandes...</p>
    } @else if (error) {
      <p class="error">{{ error }}</p>
    } @else if (orders.length === 0) {
      <p class="empty">Vous n'avez pas encore passé de commande.</p>
      <button routerLink="/landing">Continuer vos achats</button>
    } @else {
      <div class="orders-list">
        @for (order of orders; track order._id) {
          <div class="order-card">
            <div class="order-header">
              <h3>Commande #{{ order._id.slice(-6) }}</h3>
              <span class="order-date">
                {{ order.createdAt | date:'dd MMM yyyy à HH:mm' }}
              </span>
              <span class="status-badge {{ getStatusClass(order.status) }}">
                {{ order.status | titlecase }}
              </span>
            </div>
  
            <div class="order-items">
              @for (item of order.items; track item.product._id) {
                <div class="order-item">
                  <div class="item-name">{{ item.product.name }}</div>
                  <div class="item-quantity">× {{ item.quantity }}</div>
                  <div class="item-price">{{ item.priceAtPurchase }} Ar</div>
                  <div class="item-total">
                    {{ item.priceAtPurchase * item.quantity }} Ar
                  </div>
                </div>
              }
            </div>
  
            <div class="order-total">
              <strong>Total : {{ order.totalPrice }} Ar</strong>
            </div>

            @if (order.status === 'pending') {
                <div class="order-actions">
                    <button class="finalize-btn" 
                    (click)="finalizeOrder(order._id, order.totalPrice)">
              Finaliser l'achat
            </button>
                  <button class="cancel-btn" (click)="cancelOrder(order._id)">
                    Annuler
                  </button>
                </div>
              }
          </div>
        }
      </div>
    }
  </div>