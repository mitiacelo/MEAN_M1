<div class="grille-container">
  <h2>Quelle √©chelle pr√©f√©rez-vous pour mod√©liser votre centre commercial?</h2>

  <div class="selects-container">
    <div class="select-group">
      <label for="lignes">Nombre de lignes :</label>
      <select id="lignes" [(ngModel)]="lignes" name="lignes">
        <option *ngFor="let option of options" [value]="option">{{ option }}</option>
      </select>
    </div>
    <div class="select-group">
      <label for="colonnes">Nombre de colonnes :</label>
      <select id="colonnes" [(ngModel)]="colonnes" name="colonnes">
        <option *ngFor="let option of options" [value]="option">{{ option }}</option>
      </select>
    </div>
  </div>

  <div class="format-display">
    <h3>Format choisi : {{ format }}</h3>
  </div>

  <!-- ‚úÖ Panneau : shop s√©lectionn√© -->
  <div class="shop-action-panel" *ngIf="selectedShopId && !modeModification">
    <p>Que voulez-vous faire avec ce shop ?</p>
    <button class="btn-danger" (click)="supprimerShop()">üóë Supprimer</button>
    <button class="btn-warning" (click)="modifierShop()">‚úèÔ∏è Modifier les blocs</button>
    <button class="btn-cancel" (click)="annulerSelection()">Annuler</button>
  </div>

  <!-- ‚úÖ Panneau : mode modification -->
  <div class="shop-action-panel" *ngIf="modeModification">
    <p>S√©lectionnez les nouveaux blocs pour ce shop</p>
    <button class="btn-success" (click)="reassignerShop()" [disabled]="selectedCells.size === 0">
      ‚úÖ R√©assigner ({{ selectedCells.size }} blocs)
    </button>
    <button class="btn-cancel" (click)="annulerSelection()">Annuler</button>
  </div>

  <div class="grille-visuelle">
    <h3>Aper√ßu de la grille :</h3>

    <table class="grille-table"
      [style.--colonnes]="colonnes"
      [style.--lignes]="lignes">
      <thead>
        <tr>
          <th></th>
          <th *ngFor="let num of getNumeros()">{{ num }}</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let lettre of getLettres()">
          <td class="lettre-col">{{ lettre }}</td>
          <td
            *ngFor="let num of getNumeros()"
            class="block-cell"
            [class.selected]="isSelected(lettre, num)"
            [class.assigned]="isAssigned(lettre, num) && !isInSelectedShop(lettre, num)"
            [class.shop-selected]="isInSelectedShop(lettre, num)"
            [style.background-color]="getBlockColor(lettre, num)"
            (click)="toggleCell(lettre, num)"
          >
            <span *ngIf="!isAssigned(lettre, num)">
              {{ getBlockId(lettre, num) }}
            </span>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Boutons principaux cach√©s pendant une action sur un shop -->
  <ng-container *ngIf="!selectedShopId && !modeModification">
    <button (click)="sauvegarder()" class="save-btn">
      {{ grilleExiste ? 'Mettre √† jour la grille' : 'Sauvegarder cette grille' }}
    </button>
    <button
      class="save-btn"
      (click)="creerShopDepuisSelection()"
      [disabled]="selectedCells.size === 0">
      Cr√©er un shop avec les blocs s√©lectionn√©s
    </button>
    <button
    class="save-btn"
    (click)="validerGrille()"
    [disabled]="!grilleExiste">
    Valider et voir le dashboard ‚Üí
  </button>
  </ng-container>

  <p *ngIf="grilleExiste" class="message-info">
    Grille actuelle : {{ grilleId }} ({{ lignes }}√ó{{ colonnes }})
  </p>
</div>