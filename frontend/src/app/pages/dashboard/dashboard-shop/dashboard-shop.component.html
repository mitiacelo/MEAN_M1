<div class="dashboard-shop-container">
    <header class="dashboard-header">
      <h1>Tableau de bord - {{ shop?.name || 'Ma boutique' }}</h1>
      <p>Bienvenue, {{ authService.currentUser?.firstname }} !</p>
  
      <div class="actions">
        <button class="btn logout" (click)="logout()">Déconnexion</button>
        <button class="btn back" routerLink="/">Retour à l'accueil</button>
      </div>
    </header>
  
    @if (loadingShop || loadingProducts || loadingTypes) {
      <p class="loading">Chargement en cours...</p>
    } @else if (errorMessage) {
      <p class="error">{{ errorMessage }}</p>
    } @else if (shop) {
      <!-- Infos boutique -->
      <div class="shop-info">
        <h2>{{ shop.name }}</h2>
        <p>Superficie : {{ shop.superficie }} m²</p>
        <p>Statut : {{ shop.status }}</p>
        <p>{{ shop.description || 'Aucune description' }}</p>
      </div>
  
      <!-- Formulaire d'ajout -->
      <div class="product-form">
        <h2>Ajouter un produit</h2>
        <form (ngSubmit)="addProduct()">
          <div>
            <label for="name">Nom :</label>
            <input id="name" [(ngModel)]="newProduct.name" required />
          </div>
          <div>
            <label for="description">Description :</label>
            <textarea id="description" [(ngModel)]="newProduct.description"></textarea>
          </div>
          <div>
            <label for="id_type">Type de produit :</label>
            <select id="id_type" [(ngModel)]="newProduct.id_type" required>
              <option value="" disabled>Sélectionner un type</option>
              @for (type of types; track type._id) {
                <option [value]="type._id">{{ type.name }}</option>
              }
            </select>
          </div>
  
          <button type="submit" [disabled]="!newProduct.name || !newProduct.id_type">
            Ajouter
          </button>
        </form>
      </div>
  
      <!-- Liste des produits -->
      <h3>Mes produits ({{ products.length }})</h3>
  
      @if (products.length === 0) {
        <p>Aucun produit ajouté pour le moment.</p>
      } @else {
        @for (product of products; track product._id) {
          <div class="product-item">
            @if (editingProductId !== product._id) {
              <!-- Mode lecture -->
              <h3>{{ product.name }}</h3>
              <p>{{ product.description || 'Pas de description' }}</p>
              <p>Type : {{ product.id_type?.name || 'Non spécifié' }}</p>
  
              <div class="actions">
                <button class="update-btn" (click)="startEdit(product)">Modifier</button>
                <button class="delete-btn" (click)="deleteProduct(product._id)">Supprimer</button>
              </div>
            } @else {
              <!-- Mode édition -->
              <h3>
                <input type="text" [(ngModel)]="editingProduct.name" required />
              </h3>
              <p>
                <textarea [(ngModel)]="editingProduct.description"></textarea>
              </p>
              <div>
                <label for="edit_type">Type :</label>
                <select [(ngModel)]="editingProduct.id_type" required>
                  <option value="" disabled>Sélectionner un type</option>
                  @for (type of types; track type._id) {
                    <option [value]="type._id">{{ type.name }}</option>
                  }
                </select>
              </div>
  
              <div class="actions">
                <button class="save-btn" (click)="saveEdit()" [disabled]="!editingProduct.name || !editingProduct.id_type">
                  Enregistrer
                </button>
                <button class="cancel-btn" (click)="cancelEdit()">Annuler</button>
              </div>
            }
          </div>
        }
      }
    } @else {
      <p>Vous n'avez pas encore de boutique associée.</p>
    }
  </div>